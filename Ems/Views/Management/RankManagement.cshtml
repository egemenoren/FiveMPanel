@model IEnumerable<Ems.Data.Model.Ranks>
@{
    Layout = "~/Views/Shared/_Layout.cshtml";
}




<div class="content-wrapper">
    <div>
        <div class="col-11">
            <a href="/Management/AddRank"><input value="Yeni Rank Ekle" class="btn btn-success float-right mt-5"></a>
        </div>
    </div>
    <div class="row offset-1 d-flex justify-content-start">
        <div class="col-md-12 mt-5">
            <div class="btn btn-outline-danger job" value="Doktor">
                Doktor
            </div>
            <div class="btn btn-outline-info job" value="Polis">
                Polis
            </div>
            <div class="btn btn-outline-warning job" value="Sheriff">
                Sheriff
            </div>
            <div class="btn btn-outline-primary job" value="State Polis">
                State
            </div>
            <div class="btn btn-outline-success job" value="Tümü">
                Tümü
            </div>

        </div>

    </div>


    <div class="d-flex justify-content-center">
        <div class="col-md-10 mt-3">
            <div class="card card-info">
                <div class="card-header">
                    <h3 class="card-title">Rank Sıralaması</h3>

                    <div class="card-tools">
                        <button type="button" class="btn btn-tool" data-card-widget="collapse" title="Collapse">
                            <i class="fas fa-minus"></i>
                        </button>
                    </div>
                </div>
                <div class="card-body p-0">
                    <div class="text-center" id="spinner">
                        <div class="spinner-border" role="status">
                            <span class="sr-only">Loading...</span>
                        </div>
                    </div>
                    <table class="table">
                        <thead>
                            <tr>
                                <th colspan="4">Rank Adı</th>
                                <th colspan="2">Meslek</th>
                                <th colspan="2">Meslek Paneli</th>
                                <th colspan="2">Yönetim Paneli</th>
                                <th colspan="2">İşlemler</th>
                            </tr>
                        </thead>

                        <tbody id="tableBody">

                            @foreach (var item in Model)
                            {
                                var AccessJobPanel = item.AccessJobPanel ? "Erişimi Var" : "Erişimi Yok";
                                var AccessManagementPanel = item.AccessManagementPanel ? "Erişimi Var" : "Erişimi Yok";
                                <tr id="@item.Id">
                                    <td colspan="4">@item.RankName</td>
                                    <td colspan="2">@item.JobId</td>
                                    <td colspan="2">@AccessJobPanel</td>
                                    <td colspan="2">@AccessManagementPanel</td>
                                    <td>
                                        <div class="btn-group btn-group-sm">
                                            <div class="btn btn-info" id="reviewRank"><i class="fas fa-eye"></i></div>
                                            <div class="btn btn-danger remove" value="@item.Id" id="removeRank"><i class="fas fa-trash"></i></div>
                                        </div>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
                <!-- /.card-body -->
            </div>
        </div>
    </div>
</div>
<script src="~/Content/AdminLTE/plugins/jquery/jquery.min.js"></script>
<script src="//cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script>
    $(document).ready(function () {
        $("#spinner").hide();
    })
    $(".job").on("click", function (event) {
        var res = $(this).serialize();
        var jobName = $(this).attr("value");
        var job = "?job=" + jobName;
        if (jobName == "Tümü")
            job = "";
        var content = "";
        $.ajax({
            url: '/Management/GetRanks' + job,
            type: 'GET',
            data: res,
            dataType: 'json',
            success: function (response) {
                $.each(response, function (i, v) {
                    var AccessToManagementPanel = v.AccessManagementPanel ? "Erişimi Var" : "Erişimi Yok";
                    var AccessToJobPanel = v.AccessJobPanel ? "Erişimi Var" : "Erişimi Yok";
                    $('#tableBody').html("");
                    content += '<tr id='+v.Id+'> ';
                    content += '<td colspan="4">' + v.RankName + '</td>';
                    content += '<td colspan="2">' + v.JobId + '</td>';
                    content += '<td colspan="2">' + AccessToJobPanel + '</td>';
                    content += '<td colspan="2">' + AccessToManagementPanel + '</td>';
                    content += '<td colspan="2">';
                    content += '<div class="btn-group btn-group-sm">';
                    content += '<div class="btn btn-info"><i class="fas fa-eye"></i></div>';
                    content += ' <div class="btn btn-danger" value='+v.Id+' id="removeRank"><i class="fas fa-trash"></i></div>';
                    content += '</div>';
                    content += ' </td>';
                    content += ' </tr>';
                    $('#tableBody').html(content);
                    $('.card-title').text(jobName + " Rank Sıralaması");
                })

            }

        });

    });
    $(".remove").on("click", function (event) {
        console.log("slmm");
        var res = $(this).serialize();
        var rankId = $(this).attr("value");
        console.log(rankId);
        $.ajax({
            url: '/Management/RemoveRank?id=' + rankId,
            type: 'GET',
            data: res,
            dataType: 'json',
            beforeSend: function () {
                $("table").hide();
                $("#spinner").show();
                },
            success: function () {
                $("tr#" + rankId).remove();
                $("table").show();
                $("#spinner").hide();
                Swal.fire({
                    icon: 'success',
                    title: 'Başarılır',
                    text: 'Rank Başarıyla Silindi',
                    
                })
            }

        });

    })

</script>

